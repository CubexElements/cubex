<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../fort-dropdown/fort-dropdown.html">
<link rel="import" href="../../fort-action/fort-action.html">
<link rel="import" href="../../fort-list/fort-list-menu.html">
<link rel="import" href="../../fort-list/fort-li.html">
<link rel="import" href="../../fort-icon/fort-icon.html">
<link rel="import" href="../../fort-resource/fort-resource.html">
<link rel="import" href="../../fort-behavior/fort-service-behavior.html">
<link rel="import" href="../fortifi-theme/fortifi-theme-style.html">

<dom-module id="fortifi-quick-actions">
  <template>
    <style>
      fort-dropdown fort-list-menu {
        @apply(--shadow-elevation-4dp);
      }

      fort-list-menu {
        @apply(--primary-800);
        min-width: 200px;
        opacity: 1;

        --fort-li-style: {
          color: var(--theme-2-color);
        }
      }

      :host fort-action[slot="trigger"] {
        margin: 10px 0;
      }

      :host fort-action {
        @apply --primary-700-text-secondary;
      }

      :host fort-action:hover {
        @apply --primary-700-text;
      }
    </style>
    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:org" data="{{routeData}}"></app-route>

    <fort-resource auto auth url="//[[getServiceHost('apps')]]/fortifi/quickactions/actions.json"
                   headers="[[_headers]]" data="{{actions}}"></fort-resource>

    <template is="dom-if" if="[[actions.Actions]]">
      <fort-dropdown horizontal-align="right">
        <fort-action icon="icons:add" slot="trigger"></fort-action>
        <fort-list-menu>
          <template is="dom-repeat" items="[[actions.Actions]]" as="action">
            <a href="/[[routeData.org]]/[[action.GlobalAppID]]/[[action.Path]]">
              <fort-li title="[[action.Name]]">
                <fort-icon slot="icon" icon="[[action.Icon]]"></fort-icon>
                [[action.Name]]
              </fort-li>
            </a>
          </template>
        </fort-list-menu>
      </fort-dropdown>
    </template>
  </template>

  <script>
    Polymer(
      {
        is: 'fortifi-quick-actions',

        properties: {
          _headers: {type: Object, computed: '_refreshHeaders(routeData.org)'}
        },

        _refreshHeaders: function (org)
                         {
                           if(org)
                           {
                             return {'x-fort-org': org};
                           }
                           return undefined;
                         },

        behaviors: [
          Polymer.FortServiceBehavior
        ]
      }
    );
  </script>
</dom-module>
