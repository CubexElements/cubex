<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../fort-dropdown/fort-dropdown.html">
<link rel="import" href="../../fort-action/fort-action.html">
<link rel="import" href="../../fort-list/fort-list-menu.html">
<link rel="import" href="../../fort-list/fort-li.html">
<link rel="import" href="../../fort-icon/fort-icon.html">
<link rel="import" href="../../fort-behavior/fort-i18n-behavior.html">
<link rel="import" href="../fortifi-theme/fortifi-theme-style.html">

<dom-module id="fortifi-quick-actions">
  <template>
    <style>
      fort-dropdown fort-list-menu {
        @apply(--shadow-elevation-4dp);
      }

      fort-list-menu {
        @apply(--primary-800);
        min-width: 200px;
        opacity: 1;

        --fort-li-style: {
          color: var(--theme-2-color);
        }
      }

      :host fort-action[slot="trigger"] {
        margin: 10px 0;
      }

      :host fort-action {
        @apply --primary-700-text-secondary;
      }

      :host fort-action:hover {
        @apply --primary-700-text;
      }
    </style>
    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:org" data="{{routeData}}"></app-route>

    <fortifi-registry org-data="{{_orgRegistryData}}"></fortifi-registry>

    <template is="dom-if" if="[[_orgApps]]">
      <fort-dropdown horizontal-align="right">
        <fort-action icon="icons:add" slot="trigger"></fort-action>
        <fort-list-menu>
          <template is="dom-repeat" items="[[_orgApps]]" as="gaid">
            <fortifi-app-definition gaid="[[gaid]]" app-data="{{appData}}"></fortifi-app-definition>
            <template is="dom-repeat" items="[[appData.QuickActions]]" as="action" filter="_hydrateActionResources">
              <a href="/[[routeData.org]]/[[gaid]]/[[action.Path]]">
                <fort-li title="{{i18n_c4t(action.ID, '_name')}}">
                  <fort-icon slot="icon" icon="{{action.Icon}}"></fort-icon>
                  {{i18n_c4t(action.ID, '_name')}}
                </fort-li>
              </a>
            </template>
          </template>
        </fort-list-menu>
      </fort-dropdown>
    </template>
  </template>

  <script>
    Polymer(
      {
        is: 'fortifi-quick-actions',

        properties: {
          resources: {type: Object, value: {}},
          _orgApps:  {type: Array, computed: '_computeOrgApps(_orgRegistryData)'}
        },

        _computeOrgApps: function (orgRegData)
                         {
                           if(orgRegData)
                           {
                             return Object.keys(orgRegData.AppSummary);
                           }
                           return [];
                         },

        _hydrateActionResources: function (action)
                                 {
                                   this.resources = this.hydrateResources(
                                     this.resources,
                                     action.ID + '_name',
                                     action.Name
                                   );
                                   return true;
                                 },

        behaviors: [
          Polymer.FortI18nBehavior
        ]
      }
    );
  </script>
</dom-module>
