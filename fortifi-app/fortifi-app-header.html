<link href="../../polymer/polymer.html" rel="import">
<link rel="import" href="../fortifi-theme/fortifi-theme.html">
<link rel="import" href="../../fort-action/fort-action.html">
<link rel="import" href="../../fort-icon/fort-icon.html">
<link rel="import" href="../../fort-dropdown/fort-dropdown.html">
<link rel="import" href="../../paper-styles/typography.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../iron-media-query/iron-media-query.html">

<dom-module id="fortifi-app-header" attributes="icon show-back actions">
  <template strip-whitespace>
    <style>
      :host {
        @apply --layout-horizontal;
        position: relative;
        height: 64px;
        width: 100%;
        background: var(--theme-50-color);
        padding-left: 24px;
        border-bottom: 1px solid var(--theme-600-color);
        line-height: 64px;
        overflow: hidden;
      }

      :host([show-back]) {
        padding-left: 72px;
      }

      :host #app-back {
        color: var(--accent-400-color);
        margin: 15px;
        left: -9px;
        top: 0;
        bottom: 0;
        position: absolute;
      }

      .flexchild {
        @apply --layout-flex;
      }

      #iconSlot::slotted(*) {
        overflow: hidden;
        z-index: 0;
        border-radius: 100px;
        display: inline-block;
        min-width: 40px;
        width: 40px;
        height: 40px;
        margin: 12px 16px 12px 0;
      }

      :host ::slotted(h1) {
        @apply --paper-font-title;
        margin: 0;
        padding: 0;
        line-height: 64px;
      }

      :host fort-dropdown {
        display: inline-block;
        height: 64px;
      }

      :host fort-dropdown .dropdown-trigger {
        height: 64px;
      }

      :host #actions fort-action {
        color: var(--text-color-secondary);
      }

      :host #actions fort-action:hover {
        color: var(--text-color-primary);
      }

      :host #actions ::content fort-action,
      :host #actions fort-action {
        display: inline-block;
        padding: 20px;
        line-height: normal;
      }

      :host #actions ::content fort-action:before,
      :host #actions fort-action:before {
        content: '';
        display: block;
        background: var(--theme-200-color);
        border-left: 1px solid var(--theme-600-color);
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
      }

      :host #actions ::content #more-actions fort-icon,
      :host #actions #more-actions fort-icon {
        opacity: 1;
      }

      :host #actions {
        display: -webkit-inline-flex;
        display: inline-flex;
        -webkit-flex-direction: row;
        flex-direction: row;
      }

      :host #actions #more-actions {
        @apply --accent-400-text;
      }

      :host #actions #more-actions:before {
        @apply --accent-400;
      }

      :host #actions #more-actions:hover:before {
        @apply --accent-200;
      }

      :host #actions ::content fort-action:hover:before,
      :host #actions fort-action:hover:before {
        background: var(--theme-50-color);
      }

      :host #actions .dropdown-content {
        margin-top: 1px;
        border-bottom: 1px solid var(--theme-600-color);
      }

      :host #actions .dropdown-content fort-action[primary-alt],
      :host #actions .dropdown-content ::content fort-action[primary-alt] {
        display: none;
      }

      @media all and (max-width: 700px) {
        :host #header-icon,
        :host #actions fort-action[primary],
        :host #actions ::content fort-action[primary] {
          display: none;
        }

        :host #actions .dropdown-content fort-action[primary-alt],
        :host #actions .dropdown-content ::content fort-action[primary-alt] {
          display: inline-flex;
        }
      }
    </style>

    <iron-media-query query="(max-width: 700px)" query-matches="{{_small}}"></iron-media-query>
    <template is="dom-if" if="[[showBack]]" strip-whitespace>
      <fort-action icon="icons:arrow-back" id="app-back"></fort-action>
    </template>
    <slot id="iconSlot" name="icon"></slot>

    <slot name="header"></slot>

    <div class="flexchild"></div>
    <div id="actions">
      <template is="dom-repeat" items="[[actions]]" filter="{{_filter(_small,1)}}" sort="_sort" observe="primary">
        <fort-action icon="[[item.icon]]"></fort-action>
      </template>
      <fort-dropdown hidden$="[[!_hasDropdownActions(_small)}}">
        <fort-action icon="icons:more-vert" class="dropdown-trigger" id="more-actions"></fort-action>
        <div class="dropdown-content">
          <fort-list-menu>
            <template is="dom-repeat" items="[[actions]]" filter="{{_filter(_small,0)}}" sort="_sort" observe="primary">
              <fort-li>
                <fort-icon icon="[[item.icon]]"></fort-icon>
              </fort-li>
            </template>
          </fort-list-menu>
        </div>
      </fort-dropdown>
    </div>
  </template>

  <script>Polymer(
    {
      is:         'fortifi-app-header',
      properties: {
        actions:  {
          type: Array, value: [
            {title: 'Email', icon: 'communication:email', primary: true},
            {title: 'Phone', icon: 'communication:phone', primary: true},
            {title: 'aspect', icon: 'icons:aspect-ratio'},
            {title: 'alarm', icon: 'icons:alarm-add'},
            {title: 'alarm2', icon: 'icons:alarm-add'}
          ]
        },
        showBack: {
          type:               Boolean,
          value:              true,
          reflectToAttribute: true
        },
        _small:   {type: Boolean}
      },

      _filter: function (small, position)
               {
                 small = !!small;
                 position = !!position;
                 return function (item)
                 {
                   var primary = item.hasOwnProperty('primary') && item.primary;
                   if(position)
                   { // primary
                     return (!small) && primary;
                   }
                   else
                   { // secondary
                     return small || (!primary);
                   }
                 }
               },

      _sort: function (a, b)
             {
               return a.primary > b.primary;
             },

      _hasDropdownActions: function ()
                           {
                             return this.actions.slice(0).filter(this._filter(this._small, 0), this).length > 0;
                           }
    }
  )</script>
</dom-module>
