<link href="../../polymer/polymer.html" rel="import">
<link rel="import" href="../fortifi-theme/fortifi-theme.html">
<link rel="import" href="../../fort-action/fort-action.html">
<link rel="import" href="../../fort-icon/fort-icon.html">
<link rel="import" href="../../fort-dropdown/fort-dropdown.html">
<link rel="import" href="../../paper-styles/typography.html">
<link rel="import" href="../../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../iron-media-query/iron-media-query.html">
<link rel="import" href="../../fort-behavior/fort-iterator-behavior.html">
<link rel="import" href="../../fort-behavior/fort-i18n-behavior.html">

<dom-module id="fortifi-app-header" attributes="icon back-path actions menu">
  <template strip-whitespace>
    <style>
      :host {
        width: 100%;
        display: block;
        background: var(--theme-200-color);
        border-bottom: 1px solid var(--theme-700-color);
      }

      :host #topHeader {
        @apply --layout-horizontal;
        position: relative;
        height: 64px;
        padding-left: 24px;
        line-height: 64px;
        overflow: hidden;
      }

      :host #app-back {
        margin-left: -24px;
        margin-right: 8px;
      }

      :host #app-back fort-action {
        color: var(--accent-400-color);
      }

      .flexchild {
        @apply --layout-flex;
      }

      #iconSlot::slotted(*) {
        overflow: hidden;
        z-index: 0;
        border-radius: 100px;
        display: inline-block;
        min-width: 40px;
        width: 40px;
        height: 40px;
        margin: 12px 16px 12px 0;
        padding: 0;
      }

      :host ::slotted(h1) {
        @apply --paper-font-title;
        font-weight: normal;
        margin: 0;
        padding: 0;
        line-height: 64px;
      }

      :host fort-action {
        color: var(--text-color-secondary);
        padding: 15px;
        line-height: normal;
      }

      :host fort-action:hover {
        color: var(--text-color-primary);
      }

      :host #actions fort-action:before {
        content: '';
        display: block;
        background: var(--theme-200-color);
        border-left: 1px solid var(--theme-600-color);
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        right: 0;
      }

      :host #actions {
        display: -webkit-inline-flex;
        display: inline-flex;
        -webkit-flex-direction: row;
        flex-direction: row;
      }

      :host #actions #more-actions {
        @apply --accent-400-text;
      }

      :host #actions #more-actions:before {
        @apply --accent-400;
      }

      :host #actions #more-actions:hover:before {
        @apply --accent-200;
      }

      :host fort-action:hover:before {
        background: var(--theme-50-color);
      }

      fort-list-menu {
        display: block;
      }

      :host #actions fort-dropdown {
        --fort-dropdown-style: {
          border-bottom: 1px solid var(--theme-600-color);
          @apply --theme-100;
        };
      }

      :host #actions fort-dropdown fort-icon {
        padding: 0;
      }

      :host #actions fort-dropdown fort-action[primary-alt] {
        display: none;
      }

      :host #menu a {
        text-decoration: none;
      }

      :host #menu a:hover {
        color: var(--accent-400-color);
      }

      :host #menu a:hover fort-action {
        @apply --text-primary;
      }

      :host #menu fort-action {
        @apply --paper-font-body2;
        padding: 12px 11px 10px 11px;
        text-transform: uppercase;
        border-bottom: 2px solid transparent;
        margin-left: 8px;
        --paper-button-ink-color: var(--accent-400-color);
      }

      :host #menu fort-action[active] {
        border-bottom-color: var(--accent-400-color);
        color: var(--accent-400-color);
      }

      @media all and (max-width: 700px) {
        :host fort-action[primary] {
          display: none;
        }

        :host #actions fort-dropdown fort-action[primary-alt] {
          display: inline-flex;
        }
      }
    </style>

    <div id="topHeader">
      <iron-media-query query="(max-width: 700px)" query-matches="{{_small}}"></iron-media-query>
      <template is="dom-if" if="[[backPath]]" strip-whitespace>
        <a id="app-back" href="[[backPath]]">
          <fort-action icon="icons:arrow-back" size="24"></fort-action>
        </a>
      </template>
      <slot id="iconSlot" name="icon"></slot>

      <slot name="header"></slot>

      <div class="flexchild"></div>
      <div id="actions">
        <template is="dom-repeat" items="[[actions]]" filter="{{_filter(_small,1)}}" sort="_sort" observe="primary">
          <fort-action icon="[[item.Icon]]"></fort-action>
        </template>
        <fort-dropdown horizontal-align="right" hidden$="[[!_hasDropdownActions(actions,_small,1)}}">
          <fort-action icon="icons:more-vert" slot="trigger" id="more-actions"></fort-action>
          <fort-list-menu>
            <template is="dom-repeat" items="[[actions]]" filter="{{_filter(_small,0)}}" sort="_sort" observe="primary">
              <a href="[[item.Path]]">
                <fort-li>[[item.Title]]</fort-li>
              </a>
            </template>
          </fort-list-menu>
        </fort-dropdown>
      </div>
    </div>

    <slot name="hero"></slot>

    <div id="menu">
      <template is="dom-repeat" items="[[menu]]">
        <a href="[[item.Path]]">
          <fort-action>[[item.Title]]</fort-action>
        </a>
      </template>
    </div>
  </template>

  <script>Polymer(
    {
      is:         'fortifi-app-header',
      properties: {
        actions:  {type: Array, value: []},
        backPath: {type: String},
        _small:   {type: Boolean}
      },

      _filter: function (small, position)
               {
                 small = !!small;
                 position = !!position;
                 return function (item)
                 {
                   var primary = item.hasOwnProperty('primary') && item.primary;
                   if(position)
                   { // primary
                     return (!small) && primary;
                   }
                   else
                   { // secondary
                     return small || (!primary);
                   }
                 }
               },

      _sort: function (a, b)
             {
               return a.primary > b.primary;
             },

      _hasDropdownActions: function (actions, small, primary)
                           {
                             if(actions && small !== undefined && primary !== undefined)
                             {
                               return actions.slice(0).filter(this._filter(small, 0), this).length > 0;
                             }
                           }
    }
  )</script>
</dom-module>
