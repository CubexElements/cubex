<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="fortifi-theme-style.html">

<!--
An element to set the page theme

Example:

    <fortifi-theme primary="fortifi-blue" accent="fortifi-navy" theme="dark"></fortifi-theme>

@demo demo/index.html
-->

<dom-module id="fortifi-theme">
  <template>
    <style>:host {
      display: block;
      width: 100%;
      height: 100%
    }</style>
    <slot></slot>
  </template>
  <script>
    Polymer(
      {
        is:             'fortifi-theme',
        properties:     {
          primary: {type: String, value: 'fortifi-navy', observer: '_updatePrimary'},
          accent:  {type: String, value: 'fortifi-blue', observer: '_updateAccent'},
          theme:   {type: String, value: 'light', observer: '_updateTheme'}
        },
        _doc:           (function ()
        {
          var script = document._currentScript || document.currentScript;
          return script && script.ownerDocument || document;
        }()),
        _regex:         /[^a-z0-9\-]/,
        _import:        function (type, name)
                        {
                          if(!name)
                          {
                            return;
                          }
                          var dom = this,
                            prefix = 'fortifi-theme-' + type,
                            cs = dom.querySelector('#' + prefix),
                            fullName = prefix + '-' + name;

                          if(!cs)
                          {
                            cs = document.createElement('custom-style');
                            cs.id = prefix;
                            dom.appendChild(cs);
                          }

                          var s = cs.querySelector('style');
                          if(s && s.getAttribute('include') === fullName)
                          {
                            return;
                          }

                          this.importHref(
                            this.resolveUrl('styles/' + type + '/' + fullName + '.html'),
                            function ()
                            {
                              while(e = cs.firstChild)
                              {
                                cs.removeChild(e);
                              }

                              s = document.createElement('style');
                              s.setAttribute('include', fullName);
                              cs.appendChild(s);
                              CustomStyle.processHook(s);
                              Polymer.updateStyles();
                            }, null, true
                          );
                        },
        _updatePrimary: function (v)
                        {
                          this._import('primary', v.replace(this._regex, ''));
                        },
        _updateAccent:  function (v)
                        {
                          this._import('accent', v.replace(this._regex, ''));
                        },
        _updateTheme:   function (v)
                        {
                          this._import('theme', v.replace(this._regex, ''));
                        }
      }
    );
  </script>
</dom-module>
