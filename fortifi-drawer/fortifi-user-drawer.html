<link href="../../polymer/polymer.html" rel="import">
<link href="../../iron-flex-layout/iron-flex-layout.html" rel="import">
<link href="fortifi-user-drawer-items.html" rel="import">
<link rel="import" href="../../iron-pages/iron-pages.html">
<link rel="import" href="../../fort-nudge/fort-nudge.html">
<link rel="import" href="../../fort-action/fort-action.html">
<link rel="import" href="../../fort-behavior/fort-iterator-behavior.html">
<link rel="import" href="../../fort-behavior/fort-element-path-behavior.html">


<dom-module id="fortifi-user-drawer" attributes="drawer">
  <template>
    <style>
      :host > #contentContainer {
        display: block;
        padding-right: var(--fortifi-drawer-peek-width);
        width: calc(var(--fortifi-drawer-width) - var(--fortifi-drawer-peek-width) - 2px);
        background: var(--theme-100-color);
      }

      :host ::slotted(fortifi-user-drawer) {
        position: relative;
        min-width: 100%;
        min-height: 100%;
        width: var(--fortifi-drawer-peek-width);
        display: block;
        padding-right: var(--fortifi-drawer-peek-width);
      }

      fortifi-user-drawer-items {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: var(--fortifi-drawer-peek-width);
        z-index: 1;
        background: var(--primary-800-color);
        color: white
      }

      fortifi-user-drawer-items fort-action {
        padding: 12px
      }

      #lockUserDrawer {
        position: absolute;
        bottom: 0;
        left: 0;
        color: var(--text-color-secondary);
        cursor: pointer;
        padding: 10px;
      }

      #lockUserDrawer[hidden] {
        display: none;
      }
    </style>
    <fortifi-user-drawer-items>
      <fort-nudge count="3">
        <fort-action icon="communication:phone" on-tap="_openUserDrawerApp" data-page-id="phone"></fort-action>
      </fort-nudge>
      <fort-nudge count="1">
        <fort-action icon="communication:email" on-tap="_openUserDrawerApp" data-page-id="email"></fort-action>
      </fort-nudge>
    </fortifi-user-drawer-items>

    <div id="contentContainer">
      <iron-pages id="userPages" selected="none" attr-for-selected="data-page-id">
        <div data-page-id="none">nun :(</div>
        <div data-page-id="phone">PHONE Lorem ipsum dolor sit amet, consectetur adipisicing elit. Architecto
                                  autem
                                  consequatur dignissimos doloremque doloribus nihil porro rem sed similique
                                  sit!
                                  Accusamus earum harum hic impedit, maiores quas repellat ut vel?
        </div>
        <div data-page-id="email">EMAIL Lorem ipsum dolor sit amet, consectetur adipisicing elit. Blanditiis
                                  commodi
                                  consequatur deleniti dolorem dolores doloribus in inventore, placeat porro
                                  quisquam quos
                                  repellat sequi sint? Assumenda eum itaque perferendis perspiciatis quisquam!
        </div>
      </iron-pages>
      <fort-action icon="icons:chrome-reader-mode" id="lockUserDrawer" on-tap="_lockUserDrawer"></fort-action>

    </div>
  </template>
  <script>Polymer(
    {
      is:                 'fortifi-user-drawer',
      behaviors:          [
        Polymer.FortElementPathBehavior,
        Polymer.FortIteratorBehavior
      ],
      attached:           function ()
                          {
                            this.drawer = this._getDrawer();
                          },
      properties:         {
        drawer: {
          type: Object
        }
      },
      _getDrawer:         function ()
                          {
                            var drawer = null;
                            this.iterate(
                              this.getPath(this), function (parent)
                              {
                                if(parent.tagName == 'FORTIFI-DRAWER')
                                {
                                  drawer = parent;
                                  return true;
                                }
                              }
                            );
                            return drawer;
                          },
      _openUserDrawerApp: function (e)
                          {
                            this.iterate(
                              this.querySelectorAll('fortifi-user-drawer-items [active]'),
                              function (e)
                              {
                                e.removeAttribute('active');
                              }
                            );
                            e.currentTarget.setAttribute('active', true);
                            var page = e.currentTarget.getAttribute('data-page-id');
                            if(this.$.userPages.selected == page)
                            {
                              if(this.drawer.state == 2)
                              {
                                this._userDrawerPrevState = 2;
                                this.drawer.setMaxState(1);
                                this.drawer.setState(this.drawer.maxState);
                              }
                              this.drawer.toggle();
                              if(!this.drawer.isOpen)
                              {
                                e.currentTarget.removeAttribute('active');
                              }
                            }
                            else
                            {
                              this.$.userPages.select(page);
                              this.drawer.open();
                            }
                            if(this.drawer.isOpen && this._userDrawerPrevState > 0)
                            {
                              this.drawer.setMaxState(this._userDrawerPrevState);
                              this.drawer.setState(this.drawer.maxState);
                            }
                          },
      _lockUserDrawer:    function ()
                          {
                            this.drawer.setMaxState(this.drawer.state == 2 ? 1 : 2);
                            this.drawer.setState(this.drawer.maxState);
                            this._userDrawerPrevState = this.drawer.state;
                          }
    }
  )</script>
</dom-module>
