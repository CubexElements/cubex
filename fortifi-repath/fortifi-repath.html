<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="../../app-route/app-location.html">
<link rel="import" href="../../app-route/app-route.html">
<link rel="import" href="../../fort-behavior/fort-service-behavior.html">

<dom-module id="fortifi-repath" attributes="in service gaid out">
  <template>
    <app-location route="{{route}}"></app-location>
    <app-route route="[[route]]" pattern="/:org/:vendor/:app" data="{{routeData}}"></app-route>
  </template>

  <script>
    Polymer(
      {
        is:         'fortifi-repath',
        properties: {
          'in':      {type: String},
          'service': {type: String},
          'gaid':    {type: String},
          'out':     {
            type:     String,
            notify:   true,
            computed: '_computePath(in,service,gaid,routeData.org,routeData.vendor,routeData.app)'
          }
        },

        _computePath: function (inPath, service, gaid, org, vendor, app)
                      {
                        if(inPath && (service || org) && (gaid || (vendor && app)))
                        {
                          var paths = [];
                          if(service)
                          {
                            paths.push('/' + this.getServiceHost(service));
                          }
                          else if(org)
                          {
                            paths.push(org);
                          }

                          if((gaid === undefined) && vendor && app)
                          {
                            gaid = vendor + '/' + app;
                          }

                          if(gaid)
                          {
                            paths.push(gaid);
                          }
                          if(inPath)
                          {
                            paths.push(inPath.replace(/^\//, ''));
                          }

                          return '/' + paths.join('/');
                        }
                      },

        behaviors: [Polymer.FortServiceBehavior]
      }
    );
  </script>
</dom-module>
